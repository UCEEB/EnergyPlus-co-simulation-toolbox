<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of cleanup_project</title>
  <meta name="keywords" content="cleanup_project">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../functionIndex.html">Home</a> &gt;  <a href="functionIndex.html">.</a> &gt; cleanup_project.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../functionIndex.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="functionIndex.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>cleanup_project
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function cleanup_project(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [] = matproj(varargin)</a></li><li><a href="#_sub2" class="code">function [numSaved] = save_matproj(outName,useGUI,varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function cleanup_project(varargin)</a>
0002 disp(<span class="string">'-------------- Running project cleanup -----------------------------'</span>)
0003 
0004 verbose = 1;
0005 
0006 <span class="comment">% Project Root</span>
0007 <span class="keyword">if</span> nargin == 0
0008     <span class="comment">% Get simulink project</span>
0009     <span class="keyword">if</span> numel(slproject.getCurrentProjects) &gt; 0
0010         proj = slproject.getCurrentProject;
0011         projRootFolder = proj.RootFolder;
0012     <span class="keyword">else</span>
0013         <span class="comment">% error. No project loaded.</span>
0014         slproject.getCurrentProject
0015     <span class="keyword">end</span>
0016 <span class="keyword">elseif</span> nargin &gt;= 1
0017     <span class="comment">% Root folder specified</span>
0018     <span class="keyword">if</span> exist(varargin{1},<span class="string">'dir'</span>) &gt; 0
0019         projRootFolder = varargin{1};
0020     <span class="keyword">else</span>
0021         error(<span class="string">'Project folder &quot;%s&quot; not found.'</span>,varargin{1});
0022     <span class="keyword">end</span>
0023 <span class="keyword">else</span>
0024     warning(<span class="string">'More options then expected'</span>);
0025 <span class="keyword">end</span>
0026 
0027 
0028 <span class="comment">%% Save state of the editor</span>
0029 disp(<span class="string">'--- Saving editor state ---'</span>)
0030 filename = <span class="string">'matproj.mat'</span>;
0031 <a href="#_sub1" class="code" title="subfunction [] = matproj(varargin)">matproj</a>(<span class="string">'SAVE'</span>, fullfile(projRootFolder, filename));
0032 disp(<span class="string">'Done'</span>);
0033 
0034 <span class="comment">%% Remove generated files</span>
0035 disp(<span class="string">'--- Removing generated files ---'</span>)
0036 
0037 <span class="comment">% Folders</span>
0038 dirFilter = <span class="string">'(slprj|eplusout)'</span>;
0039 dirList = dirPlus(projRootFolder,<span class="keyword">...</span>
0040             <span class="string">'ReturnDirs'</span>,true,<span class="keyword">...</span>
0041             <span class="string">'DirFilter'</span>,dirFilter,<span class="keyword">...</span>
0042             <span class="string">'RecurseInvalid'</span>,true);
0043 cDir = 0;
0044 <span class="keyword">for</span> i = 1:numel(dirList)        
0045     [status, msg] = rmdir(dirList{i},<span class="string">'s'</span>);
0046     <span class="keyword">if</span> ~status        
0047         warning(<span class="string">'Folder ''%s'' could not be removed.'</span>, dirList{i});
0048     <span class="keyword">else</span>
0049         <span class="keyword">if</span> verbose
0050             fprintf(<span class="string">'Removing ''&lt;projRoot&gt;%s''.\n'</span>,strrep(dirList{i},projRootFolder,<span class="string">''</span>));            
0051         <span class="keyword">end</span>
0052         cDir = cDir + 1;
0053     <span class="keyword">end</span>
0054 <span class="keyword">end</span>
0055 <span class="keyword">if</span> ~verbose
0056     fprintf(<span class="string">'Removed %d &quot;%s&quot; folders.\n'</span>,cDir, dirFilter);
0057 <span class="keyword">end</span>
0058 
0059 <span class="comment">% Files</span>
0060 fileFilter = <span class="string">'.*\.(slxc|asv|autosave)$'</span>;
0061 fileList = dirPlus(projRootFolder,<span class="keyword">...</span>
0062             <span class="string">'FileFilter'</span>,fileFilter,<span class="keyword">...</span>
0063             <span class="string">'RecurseInvalid'</span>,true);
0064 cFile = 0;
0065 <span class="keyword">for</span> i = 1:numel(fileList)        
0066     <span class="keyword">try</span> 
0067         delete(fileList{i});
0068         <span class="keyword">if</span> verbose
0069             fprintf(<span class="string">'Removing ''&lt;projRoot&gt;%s''.\n'</span>,strrep(fileList{i},projRootFolder,<span class="string">''</span>));            
0070         <span class="keyword">end</span>
0071     <span class="keyword">catch</span>
0072         warning(<span class="string">'File ''%s'' could not be removed.'</span>, fileList{i});
0073         <span class="keyword">continue</span>
0074     <span class="keyword">end</span>
0075     cFile = cFile + 1;
0076 <span class="keyword">end</span>
0077 <span class="keyword">if</span> ~verbose
0078     fprintf(<span class="string">'Removed %d &quot;%s&quot; files.\n'</span>,cFile, fileFilter);
0079 <span class="keyword">end</span>
0080 
0081 
0082 <span class="comment">%% Functions</span>
0083 <a name="_sub1" href="#_subfunctions" class="code">function [] = matproj(varargin)</a>
0084 <span class="comment">%</span>
0085 <span class="comment">% matproj.m--Saves and loads Matlab &quot;projects&quot;. A project consists of the</span>
0086 <span class="comment">% m-files that are currently open in the Matlab Editor. Loading a project</span>
0087 <span class="comment">% returns the Matlab Editor to the state it was in when the project was</span>
0088 <span class="comment">% saved, with the same m-files open to the same lines, the working</span>
0089 <span class="comment">% directory set to that of the loaded project and the Matlab search path</span>
0090 <span class="comment">% set back to its saved value.</span>
0091 <span class="comment">%</span>
0092 <span class="comment">% When matproj.m is asked to load a project, it first saves the</span>
0093 <span class="comment">% currently-open m-files to a backup project before closing them and</span>
0094 <span class="comment">% loading the new project.</span>
0095 <span class="comment">%</span>
0096 <span class="comment">% MATPROJ by itself, with no input arguments, uses GUI dialogues to ask the</span>
0097 <span class="comment">% user whether to save or load a project, after which the user is prompted</span>
0098 <span class="comment">% for a project filename (default is 'matproj.mat' in the current</span>
0099 <span class="comment">% directory).</span>
0100 <span class="comment">%</span>
0101 <span class="comment">% MATPROJ('SAVE',FILENAME) saves the current project to the specified file</span>
0102 <span class="comment">% without using GUI dialogues.</span>
0103 <span class="comment">%</span>
0104 <span class="comment">% MATPROJ('LOAD',FILENAME) loads the project from the specified file</span>
0105 <span class="comment">% without using GUI dialogues.</span>
0106 <span class="comment">%</span>
0107 <span class="comment">% MATPROJ('ADD',FILENAME) adds the project from the specified file</span>
0108 <span class="comment">% without closing files currently open and without using GUI dialogues.</span>
0109 <span class="comment">%</span>
0110 <span class="comment">% MATPROJ('SAVE') saves the current project; a file-selection GUI dialogue</span>
0111 <span class="comment">% prompts the user to choose a destination file.</span>
0112 <span class="comment">%</span>
0113 <span class="comment">% MATPROJ('LOAD') loads a project;  a file-selection GUI dialogue prompts</span>
0114 <span class="comment">% the user to choose a file for loading.</span>
0115 <span class="comment">%</span>
0116 <span class="comment">% e.g.,   matproj</span>
0117 <span class="comment">%         matproj('save','/home/bartlett/matproj.mat')</span>
0118 <span class="comment">%         matproj('load','/home/bartlett/matproj.mat')</span>
0119 <span class="comment">%         matproj('add','/home/bartlett/matproj.mat')</span>
0120 <span class="comment">%         matproj('save')</span>
0121 <span class="comment">%         matproj('load')</span>
0122 
0123 <span class="comment">% Developed in Matlab 7.12.0.635 (R2011a) on GLNX86</span>
0124 <span class="comment">% for the VENUS project (http://venus.uvic.ca/).</span>
0125 <span class="comment">% Kevin Bartlett (kpb@uvic.ca), 2012-06-13 18:08</span>
0126 <span class="comment">%-------------------------------------------------------------------------</span>
0127 
0128 <span class="comment">% See</span>
0129 <span class="comment">% http://blogs.mathworks.com/community/2011/05/09/r2011a-matlab-editor-api/</span>
0130 <span class="comment">% for information on how a lot of this stuff works.</span>
0131 
0132 <span class="comment">%-------------------------------------------------------------------------</span>
0133 <span class="comment">% REVISION HISTORY</span>
0134 <span class="comment">%-------------------------------------------------------------------------</span>
0135 <span class="comment">%</span>
0136 <span class="comment">% 2015-09-18--Added code to &quot;repair&quot; path in the event of a Matlab upgrade.</span>
0137 <span class="comment">%</span>
0138 <span class="comment">% 2016-02-25--Path repair not working on Windows. Bug fixed.</span>
0139 <span class="comment">%</span>
0140 <span class="comment">% 2016-04-28--Added action ADD. (user contribution from &quot;Andres&quot;).</span>
0141 <span class="comment">%</span>
0142 <span class="comment">%-------------------------------------------------------------------------</span>
0143 
0144 <span class="comment">%-------------------------------------------------------------------------</span>
0145 <span class="comment">% Possible improvements:</span>
0146 <span class="comment">%</span>
0147 <span class="comment">% 1) Have a single, central file containing all projects, rather than a</span>
0148 <span class="comment">% separate matproj.mat file for each project?</span>
0149 <span class="comment">%-------------------------------------------------------------------------</span>
0150 
0151 <span class="keyword">if</span> nargin &gt; 0
0152     actionStr = varargin{1};
0153 <span class="keyword">else</span>
0154     actionStr = <span class="string">''</span>;
0155 <span class="keyword">end</span>
0156 
0157 <span class="keyword">if</span> nargin &gt; 1
0158     fileName = varargin{2};
0159 <span class="keyword">else</span>
0160     fileName = <span class="string">''</span>;
0161 <span class="keyword">end</span>
0162 
0163 <span class="keyword">if</span> ~matlab.desktop.editor.isEditorAvailable
0164     error([<span class="string">'Cannot run '</span> mfilename <span class="string">' without Java support.'</span>]);
0165 <span class="keyword">end</span>
0166 
0167 <span class="comment">% Stick with command-line interface unless user wants GUI.</span>
0168 useGUI = false;
0169 
0170 <span class="keyword">if</span> isempty(actionStr)
0171     <span class="comment">% No action specified. Get via GUI.</span>
0172     useGUI = true;
0173     actionList = {<span class="string">'Save'</span>, <span class="string">'Load'</span>, <span class="string">'Add'</span>};
0174     [Selection,isOk] = listdlg(<span class="string">'ListString'</span>,actionList,<span class="keyword">...</span>
0175         <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0176         <span class="string">'ListSize'</span>,[160 60],<span class="keyword">...</span>
0177         <span class="string">'Name'</span>,<span class="string">'matproj'</span>,<span class="keyword">...</span>
0178         <span class="string">'PromptString'</span>,<span class="string">'Select Project Action'</span>);
0179     
0180     <span class="keyword">if</span> isOk
0181         actionName = actionList{Selection};
0182     <span class="keyword">else</span>
0183         actionName = <span class="string">'Cancel'</span>;
0184     <span class="keyword">end</span>
0185     
0186     actionStr = lower(actionName);
0187 <span class="keyword">end</span>
0188 
0189 SAVE = 1;
0190 LOAD = 2;
0191 ADD = 3;
0192 
0193 <span class="keyword">if</span> strcmpi(actionStr,<span class="string">'save'</span>)
0194     action = SAVE;
0195 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'load'</span>)
0196     action = LOAD;
0197 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'add'</span>)
0198     action = ADD;
0199 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'cancel'</span>)
0200     <span class="keyword">return</span>;
0201 <span class="keyword">else</span>
0202     error([mfilename <span class="string">'.m--Unrecognised action string '''</span> actionStr <span class="string">'''.'</span>]);
0203 <span class="keyword">end</span>
0204 
0205 <span class="keyword">if</span> isempty(fileName)
0206     <span class="comment">% No filename specified. Choose it with a GUI.</span>
0207     useGUI = true;
0208     <span class="keyword">if</span> action == LOAD
0209         [fileName, pathName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to load.'</span>,pwd);
0210     <span class="keyword">elseif</span> action == ADD
0211         [fileName, pathName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to add.'</span>,pwd);
0212     <span class="keyword">elseif</span> action == SAVE
0213         [fileName, pathName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to save.'</span>,fullfile(pwd,<span class="string">'matproj.mat'</span>));
0214     <span class="keyword">end</span>
0215     
0216     <span class="keyword">if</span> isa(fileName,<span class="string">'double'</span>)
0217         <span class="keyword">return</span>;
0218     <span class="keyword">end</span>
0219     fullName = fullfile(pathName,fileName);
0220 <span class="keyword">else</span>
0221     fullName = fullfile(fileName);
0222 <span class="keyword">end</span>
0223 
0224 <span class="keyword">if</span> action == LOAD || action == ADD
0225     <span class="comment">% Save a backup of the current desktop.</span>
0226     docHndl = matlab.desktop.editor.getAll();
0227     numFiles = length(docHndl);
0228     
0229     <span class="keyword">if</span> numFiles &gt; 0
0230         <span class="comment">% Only save a backup if there are files open.</span>
0231         disp([mfilename <span class="string">'.m--Saving backup of existing project...'</span>])
0232         backupFileName = fullfile(prefdir,<span class="string">'matproj.bak.mat'</span>);
0233         numSaved = <a href="#_sub2" class="code" title="subfunction [numSaved] = save_matproj(outName,useGUI,varargin)">save_matproj</a>(backupFileName,useGUI,docHndl);
0234         
0235         <span class="keyword">if</span> numSaved &lt; 0
0236             <span class="comment">% save_matproj.m returns -1 if aborting.</span>
0237             <span class="keyword">return</span>;
0238         <span class="keyword">end</span>
0239         
0240         <span class="keyword">if</span> numSaved == 0
0241             disp([mfilename <span class="string">'.m--Backup of existing project NOT saved.'</span>])
0242         <span class="keyword">else</span>
0243             disp([mfilename <span class="string">'.m--Backup of existing project saved to '</span> backupFileName <span class="string">'.'</span>])
0244         <span class="keyword">end</span>
0245     <span class="keyword">end</span>
0246     
0247     <span class="comment">% Read in previously-saved project info.</span>
0248     [~,~,ext] = fileparts(fullName);
0249     <span class="keyword">if</span> strcmp(ext,<span class="string">'.mat'</span>)
0250         whoOut = who(<span class="string">'-file'</span>,fullName);
0251         <span class="keyword">if</span> ~ismember(<span class="string">'matprojData'</span>,whoOut)
0252             error([mfilename <span class="string">'.m--Specified .mat file does not appear to contain matproj data.'</span>]);
0253         <span class="keyword">end</span>
0254         load(fullName,<span class="string">'matprojData'</span>);
0255     <span class="keyword">else</span>
0256         error([mfilename <span class="string">'.m--Specified file is not a .mat file.'</span>]);
0257     <span class="keyword">end</span>
0258     
0259     <span class="keyword">if</span> action == LOAD
0260         <span class="comment">% Close existing project. This won't happen if action is ADD.</span>
0261         docHndl = matlab.desktop.editor.getAll();
0262         numFiles = length(docHndl);
0263         <span class="keyword">for</span> iFile = 1:numFiles
0264             docHndl(iFile).close;
0265         <span class="keyword">end</span>
0266     <span class="keyword">end</span>
0267     
0268     <span class="comment">% Open previously-saved project.</span>
0269     numFiles = length(matprojData.files);
0270     
0271     <span class="keyword">for</span> iFile = 1:numFiles
0272         thisMatProjMember = matprojData.files(iFile);
0273         thisFileName = thisMatProjMember.Filename;
0274         thisSelection = thisMatProjMember.Selection;
0275         thisEditable = thisMatProjMember.Editable;
0276         
0277         <span class="comment">% 2015-01-28--Thanks to David Brown for pointing this out. Loading</span>
0278         <span class="comment">% a project fails if it was saved with an unsaved &quot;untitled&quot; mfile</span>
0279         <span class="comment">% in it. Test to avoid the error.</span>
0280         [thisFilePath,~,ext] = fileparts(thisFileName);
0281         <span class="keyword">if</span> isempty(thisFilePath)
0282             warning([mfilename <span class="string">'.m--Skipping loading file '''</span> thisFileName ext <span class="string">''' because no path information for it was found.'</span>]);
0283         <span class="keyword">else</span>
0284             editorObj = matlab.desktop.editor.openDocument(thisFileName);
0285             
0286             <span class="keyword">if</span> isempty(editorObj)
0287                 warning([mfilename <span class="string">'.m--File '</span> thisFileName <span class="string">' from loaded project was not found.'</span>]);
0288             <span class="keyword">else</span>
0289                 
0290                 <span class="keyword">if</span> isempty(thisSelection)
0291                     thisSelection = [1 1 1 1];
0292                 <span class="keyword">end</span> <span class="comment">% end if isempty(thisSelection)</span>
0293                 
0294                 editorObj.Selection = thisSelection;
0295                 editorObj.Editable = thisEditable;
0296             <span class="keyword">end</span> <span class="comment">% if isempty(editorObj)</span>
0297             
0298         <span class="keyword">end</span> <span class="comment">% if isempty thisFilePath</span>
0299         
0300     <span class="keyword">end</span> <span class="comment">% for</span>
0301     
0302     <span class="comment">% Open the active document again to make it the current file.</span>
0303     activeDocName = matprojData.activeDocName;
0304     
0305     <span class="comment">% ...Again, make sure this isn't an unsaved &quot;untitled&quot; document.</span>
0306     [thisFilePath,~,ext] = fileparts(activeDocName);
0307     <span class="keyword">if</span> ~isempty(thisFilePath)
0308         <span class="keyword">if</span> ~isempty(activeDocName)
0309             editorObj = matlab.desktop.editor.openDocument(matprojData.activeDocName);
0310         <span class="keyword">end</span>
0311     <span class="keyword">end</span>
0312     
0313     cd(matprojData.workingDir);
0314     
0315     <span class="comment">% Set path. For backwards compatibility, check that path was saved with</span>
0316     <span class="comment">% project.</span>
0317     <span class="keyword">if</span> isfield(matprojData,<span class="string">'path'</span>)
0318         
0319         <span class="comment">% Saved path will be incorrect for the current Matlab installation</span>
0320         <span class="comment">% if Matlab has been upgraded since the .mat file was saved. Check</span>
0321         <span class="comment">% for this and repair the path if necessary.</span>
0322         
0323         <span class="comment">% ...Find Matlab root path from saved project by searching for a</span>
0324         <span class="comment">% known built-in toolbox that should be in all installations.</span>
0325         knownBuiltInName = <span class="string">'/toolbox/matlab/lang'</span>;
0326         savedPath = matprojData.path;
0327         
0328         <span class="keyword">if</span> strncmp(savedPath,<span class="string">'/'</span>,1)
0329             isUnixPath = true;
0330         <span class="keyword">else</span>
0331             isUnixPath = false;
0332         <span class="keyword">end</span>
0333         
0334         <span class="keyword">if</span> isUnixPath
0335             <span class="comment">% Newer Matlab versions use ';' as the filesep for both unix and</span>
0336             <span class="comment">% Windows, but older versions use ':' for unix. Standardize to ';'.</span>
0337             savedPath = strrep(savedPath,<span class="string">':'</span>,<span class="string">';'</span>);
0338         <span class="keyword">end</span>
0339         
0340         <span class="comment">% Convert saved path to a cell array.</span>
0341         savedPath = textscan(savedPath,<span class="string">'%s'</span>,<span class="string">'delimiter'</span>,<span class="string">';'</span>);
0342         savedPath = savedPath{:};
0343         
0344         <span class="comment">% For simplicity, use '/' as the file separator, regardless of</span>
0345         <span class="comment">% whether this is a unix or Windows machine.</span>
0346         savedPath = cellfun(@(x) strrep(x,<span class="string">'\'</span>,<span class="string">'/'</span>),savedPath,<span class="string">'UniformOutput'</span>,false);
0347         
0348         <span class="comment">% Get the path of the known built-in in the saved project.</span>
0349         ind = ~cellfun(<span class="string">'isempty'</span>,cellfun(@(x) regexp(x,knownBuiltInName),savedPath,<span class="string">'UniformOutput'</span>, false));
0350         assert(~isempty(find(ind)),[mfilename <span class="string">'.m--Failed to find valid path to Matlab built-in toolbox in saved path.'</span>]);
0351         knownBuiltInPath = savedPath(ind);
0352         knownBuiltInPath = knownBuiltInPath{:};
0353         
0354         <span class="comment">% Extract the saved Matlab root directory from the found built-in.</span>
0355         savedRootPath = knownBuiltInPath(1:(strfind(knownBuiltInPath,knownBuiltInName)-1));
0356         
0357         <span class="comment">% Convert the saved Matlab root directory to use the file separator</span>
0358         <span class="comment">% on the running version of Matlab.</span>
0359         knownBuiltInPath = strrep(knownBuiltInPath,<span class="string">'/'</span>,filesep);
0360         knownBuiltInPath = strrep(knownBuiltInPath,<span class="string">'\'</span>,filesep);
0361         
0362         <span class="comment">% Further ensure compatibility by removing any trailing file</span>
0363         <span class="comment">% separators from both the saved and current root paths (probably</span>
0364         <span class="comment">% not necessary).</span>
0365         <span class="keyword">if</span> strcmp(savedRootPath(end),filesep)
0366             savedRootPath(end) = [];
0367         <span class="keyword">end</span>
0368         
0369         <span class="comment">% Find the Matlab root directory in the running version of Matlab.</span>
0370         matlabRootPath = matlabroot;
0371         <span class="keyword">if</span> strcmp(matlabRootPath(end),filesep)
0372             matlabRootPath(end) = [];
0373         <span class="keyword">end</span>
0374         
0375         <span class="keyword">if</span> ~isequal(savedRootPath,matlabRootPath)
0376             <span class="comment">% The saved Matlab root path does not match the actual root</span>
0377             <span class="comment">% path. Modify the saved root path.</span>
0378             savedPath = strrep(savedPath,savedRootPath,matlabRootPath);
0379             
0380             <span class="comment">% Convert saved path from cell array to string for passing to path().</span>
0381             pathStr = <span class="string">''</span>;
0382             <span class="keyword">for</span> iPath = 1:length(savedPath)
0383                 <span class="keyword">if</span> iPath == length(savedPath)
0384                     appendStr = savedPath{iPath};
0385                 <span class="keyword">else</span>
0386                     appendStr = [savedPath{iPath} pathsep];
0387                 <span class="keyword">end</span>
0388                 
0389                 pathStr = [pathStr appendStr];
0390             <span class="keyword">end</span> <span class="comment">% for each path line</span>
0391             
0392             matprojData.path = pathStr;
0393             disp([mfilename <span class="string">'.m--Saved path repaired to match current Matlab installation.'</span>]);
0394             
0395         <span class="keyword">end</span> <span class="comment">% if matlab root path does not match.</span>
0396         
0397         <span class="comment">% Set the path.</span>
0398         path(matprojData.path);
0399         
0400     <span class="keyword">end</span> <span class="comment">% if path was saved in .mat file</span>
0401     
0402 <span class="keyword">elseif</span> action == SAVE
0403     <span class="keyword">if</span> exist(fullName,<span class="string">'file'</span>)
0404     <span class="keyword">end</span>
0405     numSaved = <a href="#_sub2" class="code" title="subfunction [numSaved] = save_matproj(outName,useGUI,varargin)">save_matproj</a>(fullName,useGUI);
0406 <span class="keyword">end</span>
0407 <span class="keyword">end</span>
0408 
0409 <span class="comment">%-------------------------------------------------------------------------</span>
0410 <a name="_sub2" href="#_subfunctions" class="code">function [numSaved] = save_matproj(outName,useGUI,varargin)</a>
0411 <span class="comment">%</span>
0412 <span class="comment">% save_matproj.m--Saves current project to named .mat file.</span>
0413 <span class="comment">%-------------------------------------------------------------------------</span>
0414 
0415 <span class="keyword">if</span> nargin&gt;2
0416     docHndl = varargin{1};
0417 <span class="keyword">else</span>
0418     docHndl = matlab.desktop.editor.getAll();
0419 <span class="keyword">end</span>
0420 
0421 numFiles = length(docHndl);
0422 
0423 <span class="keyword">if</span> numFiles == 0
0424     numSaved = 0;
0425 <span class="keyword">end</span>
0426 
0427 <span class="keyword">if</span> any(cat(1,docHndl.Modified))
0428     <span class="keyword">if</span> useGUI
0429         warndlg(<span class="string">'Unsaved edits exist in existing project. Aborting.'</span>, <span class="string">'matproj'</span>, <span class="string">'modal'</span>);
0430     <span class="keyword">else</span>
0431         disp([mfilename <span class="string">'.m--Unsaved edits exist in existing project. Aborting.'</span>]);
0432     <span class="keyword">end</span>
0433     numSaved = -1;
0434     <span class="keyword">return</span>;
0435 <span class="keyword">end</span>
0436 
0437 activeDoc = matlab.desktop.editor.getActive;
0438 files = repmat(struct(<span class="string">'Filename'</span>,<span class="string">''</span>,<span class="string">'Selection'</span>,nan(1,4),<span class="string">'Editable'</span>,NaN),numFiles,1);
0439 
0440 <span class="keyword">for</span> iFile = 1:numFiles
0441     files(iFile).Filename = docHndl(iFile).Filename;
0442     files(iFile).Selection = docHndl(iFile).Selection;
0443     files(iFile).Editable = docHndl(iFile).Editable;
0444 <span class="keyword">end</span>
0445 
0446 matprojData = struct();
0447 matprojData.files = files;
0448 matprojData.date = now;
0449 
0450 <span class="keyword">if</span> isempty(activeDoc)
0451     activeDocName = [];
0452 <span class="keyword">else</span>
0453     activeDocName = activeDoc.Filename;
0454 <span class="keyword">end</span>
0455 
0456 matprojData.activeDocName = activeDocName;
0457 matprojData.workingDir = pwd;
0458 projPath = path;
0459 matprojData.path = projPath;
0460 
0461 save(outName,<span class="string">'matprojData'</span>);
0462 numSaved = numFiles;
0463 
0464 <span class="keyword">end</span>
0465 <span class="keyword">end</span></pre></div>
<hr><address>EnergyPlus Co-simulation Toolbox &copy; 2018</address>
</body>
</html>