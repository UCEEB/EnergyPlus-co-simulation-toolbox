<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of installMlep</title>
  <meta name="keywords" content="installMlep">
  <meta name="description" content="INSTALLMLEP Install mlep tool.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../functionIndex.html">Home</a> &gt;  <a href="functionIndex.html">.</a> &gt; installMlep.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../functionIndex.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="functionIndex.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>installMlep
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>INSTALLMLEP Install mlep tool.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function installMlep </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">INSTALLMLEP Install mlep tool. 
Search for all necessary paths and save them for future use. The script is
ran automatically, but run it manually when settings need to be changed.
The settings are stored to the toolbox directory into a MLEPSETTINGS.mat
file.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [valid, idd_path] = validateEnergyPlusDir(folder)</a></li><li><a href="#_sub2" class="code">function epPath = getEplusDir(rootFolder)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function installMlep</a>
0002 <span class="comment">%INSTALLMLEP Install mlep tool.</span>
0003 <span class="comment">%Search for all necessary paths and save them for future use. The script is</span>
0004 <span class="comment">%ran automatically, but run it manually when settings need to be changed.</span>
0005 <span class="comment">%The settings are stored to the toolbox directory into a MLEPSETTINGS.mat</span>
0006 <span class="comment">%file.</span>
0007 
0008 <span class="comment">% Copyright (c) 2018, Jiri Dostal (jiri.dostal@cvut.cz)</span>
0009 <span class="comment">% All rights reserved. See the license file.</span>
0010 
0011 <span class="comment">%% === Extract paths ======================================================</span>
0012 
0013 selectByDialog = 1;
0014 <span class="keyword">if</span> ispc
0015     <span class="comment">% Windows</span>
0016     
0017     <span class="comment">% Toolbox path</span>
0018     homePath = fileparts(mfilename(<span class="string">'fullpath'</span>));
0019     
0020     <span class="comment">% EnergyPlus path</span>
0021     rootFolder = <span class="string">'C:\'</span>;
0022     eplusDirList = dirPlus(rootFolder,<span class="keyword">...</span>
0023         <span class="string">'ReturnDirs'</span>, true,<span class="keyword">...</span>
0024         <span class="string">'Depth'</span>,0,<span class="keyword">...</span>
0025         <span class="string">'DirFilter'</span>, <span class="string">'^EnergyPlusV\d-\d-\d$'</span>);
0026     
0027     <span class="comment">% Ask for assistance if necessary</span>
0028     <span class="keyword">if</span> numel(eplusDirList) == 1
0029         eplusPath = eplusDirList{1};
0030         <span class="keyword">if</span> <a href="#_sub1" class="code" title="subfunction [valid, idd_path] = validateEnergyPlusDir(folder)">validateEnergyPlusDir</a>(eplusPath)
0031             answer = questdlg(sprintf(<span class="string">'Found EnergyPlus installation &quot;%s&quot; do you want to use it?'</span>,eplusPath),<span class="keyword">...</span>
0032                 <span class="string">'Installing mlep'</span>);
0033             <span class="keyword">if</span> strcmp(answer,<span class="string">'Yes'</span>)
0034                 selectByDialog = 0;
0035             <span class="keyword">end</span>
0036         <span class="keyword">end</span>
0037     <span class="keyword">else</span>
0038         <span class="keyword">if</span> isempty(eplusDirList)
0039             f = helpdlg([<span class="string">'No EnergyPlus installation found.'</span> newline <span class="keyword">...</span>
0040                 <span class="string">'Please select the installation folder manually.'</span>],<span class="keyword">...</span>
0041                 <span class="string">'Installing mlep'</span>);
0042             waitfor(f);
0043         <span class="keyword">else</span>
0044             f = helpdlg(sprintf(<span class="string">'Multiple EnergyPlus installations found \n&quot;%s&quot;. \nPlease select the desired installation manually.'</span>,<span class="keyword">...</span>
0045                 strjoin(eplusDirList,<span class="string">'&quot;\n&quot;'</span>)),<span class="string">'Installing mlep'</span>);
0046             waitfor(f);
0047         <span class="keyword">end</span>
0048     <span class="keyword">end</span>
0049     
0050     <span class="comment">% Select manually by dialog</span>
0051     <span class="keyword">if</span> selectByDialog
0052         eplusPath = <a href="#_sub2" class="code" title="subfunction epPath = getEplusDir(rootFolder)">getEplusDir</a>(rootFolder);
0053         <span class="keyword">if</span> isempty(eplusPath)
0054             error(<span class="string">'mlep installation failed.'</span>);            
0055         <span class="keyword">end</span>
0056     <span class="keyword">end</span>
0057     
0058     <span class="comment">% Get EnergyPlus version</span>
0059     [~,iddPath] = <a href="#_sub1" class="code" title="subfunction [valid, idd_path] = validateEnergyPlusDir(folder)">validateEnergyPlusDir</a>(eplusPath);
0060     versionEnergyPlus = mlep.getEPversion(iddPath);        
0061     
0062     <span class="comment">% Java path - use Matlab internal JRE</span>
0063     javaPath = dirPlus(fullfile(matlabroot,<span class="string">'sys'</span>,<span class="string">'java'</span>),<span class="string">'FileFilter'</span>,<span class="string">'java.exe'</span>);
0064     <span class="keyword">if</span> ~isempty(javaPath)
0065         javaPath = fileparts(javaPath{1});
0066     <span class="keyword">else</span>
0067         error(<span class="string">'Java Runtime Environment not found. Please change the installation script to provide path to a Java JRE.'</span>)
0068     <span class="keyword">end</span>
0069     
0070     <span class="comment">% Get EnergyPlus command</span>
0071     eplusCommand = dirPlus(eplusPath,<span class="keyword">...</span>
0072         <span class="string">'FileFilter'</span>,<span class="string">'^(?i)energyplus.exe(?-i)$'</span>,<span class="keyword">...</span>
0073         <span class="string">'PrependPath'</span>, false);
0074     assert(~isempty(eplusCommand));
0075 <span class="keyword">else</span>
0076     rootFolder = <span class="string">'/'</span>;
0077     warndlg(<span class="string">'Only Windows installation has been tested!'</span>,<span class="string">'Installing mlep'</span>,<span class="string">'modal'</span>);
0078     f = helpdlg(<span class="string">'Select the EnergyPlus installation root folder'</span>,<span class="keyword">...</span>
0079         <span class="string">'Installing mlep'</span>);
0080     waitfor(f);
0081     eplusPath = <a href="#_sub2" class="code" title="subfunction epPath = getEplusDir(rootFolder)">getEplusDir</a>(rootFolder);
0082     javaPath = <span class="string">'usr/bin/java'</span>;
0083     
0084     <span class="comment">% Get EnergyPlus command</span>
0085     eplusCommand = dirPlus(eplusPath,<span class="keyword">...</span>
0086         <span class="string">'FileFilter'</span>,<span class="string">'^(?i)energyplus(?-i)$'</span>,<span class="keyword">...</span>
0087         <span class="string">'PrependPath'</span>, false);
0088     assert(~isempty(eplusCommand));
0089 <span class="keyword">end</span>
0090 
0091 <span class="comment">%% === Save Settings ======================================================</span>
0092 <span class="comment">% into file to load in all the following runs</span>
0093 MLEPSETTINGS = struct;
0094 
0095 MLEPSETTINGS.versionProtocol = 2;     <span class="comment">% Version of the BCVTB protocol</span>
0096 
0097 MLEPSETTINGS.versionEnergyPlus = versionEnergyPlus; <span class="comment">% EnergyPlus version</span>
0098 
0099 MLEPSETTINGS.program = eplusCommand{1}; <span class="comment">% Program name</span>
0100 
0101 bcvtbPath = fullfile(homePath,<span class="string">'bcvtb'</span>);
0102 
0103 MLEPSETTINGS.env = {<span class="keyword">...</span>
0104     {<span class="string">'ENERGYPLUS_DIR'</span>, eplusPath},<span class="keyword">...</span><span class="comment">   % Path to the EnergyPlus folder</span>
0105     {<span class="string">'BCVTB_HOME'</span>, bcvtbPath},<span class="keyword">...</span><span class="comment">       % Path to the BCVTB</span>
0106     {<span class="string">'PATH'</span>, [javaPath <span class="string">';'</span> eplusPath]}<span class="keyword">...</span><span class="comment"> % System path, should include E+ and JRE</span>
0107     };
0108 
0109 MLEPSETTINGS.eplusDir = eplusPath;
0110 MLEPSETTINGS.javaDir = javaPath;
0111 MLEPSETTINGS.homeDir = homePath;        <span class="comment">%#ok&lt;STRNU&gt;</span>
0112 
0113 <span class="comment">% Save mlep settings</span>
0114 save(fullfile(homePath,<span class="string">'MLEPSETTINGS.mat'</span>),<span class="string">'MLEPSETTINGS'</span>);
0115 
0116 disp(<span class="string">'================ mlep installation succesful ================'</span>);
0117 
0118 <span class="comment">%% === Helper functions ===================================================</span>
0119 <span class="comment">% EnergyPlus folder validation function</span>
0120     <a name="_sub1" href="#_subfunctions" class="code">function [valid, idd_path] = validateEnergyPlusDir(folder)</a>
0121         idd_path = dirPlus(folder,<span class="string">'Depth'</span>,1,<span class="string">'FileFilter'</span>,<span class="string">'^Energy\+\.idd'</span>);        
0122         valid = ~isempty(idd_path);
0123         <span class="keyword">if</span> valid
0124             idd_path = idd_path{1};
0125         <span class="keyword">end</span>
0126     <span class="keyword">end</span>
0127 
0128 <span class="comment">% Select EP dir dialog</span>
0129     <a name="_sub2" href="#_subfunctions" class="code">function epPath = getEplusDir(rootFolder)</a>
0130         isValidEplusDir = 0;
0131         <span class="keyword">while</span> ~isValidEplusDir
0132             folder = {uigetdir(rootFolder,<span class="keyword">...</span>
0133                 <span class="string">'Select EnergyPlus installation folder'</span>)
0134                 };
0135             <span class="keyword">if</span> folder{1} == 0 <span class="comment">% Cancel button</span>
0136                 epPath = [];
0137                 <span class="keyword">return</span>
0138             <span class="keyword">end</span>
0139             isValidEplusDir = <a href="#_sub1" class="code" title="subfunction [valid, idd_path] = validateEnergyPlusDir(folder)">validateEnergyPlusDir</a>(folder{1});
0140             <span class="keyword">if</span> ~isValidEplusDir
0141                 f = helpdlg([<span class="string">'Selected EnergyPlus folder is not valid.'</span> newline <span class="keyword">...</span>
0142                     <span class="string">'Please select the installation root folder (e.g. &quot;EnergyPlusV8-9-0&quot;).'</span>],<span class="keyword">...</span>
0143                     <span class="string">'EnergyPlus folder selection'</span>);
0144                 waitfor(f);
0145             <span class="keyword">else</span>
0146                 epPath = folder{1};
0147             <span class="keyword">end</span>
0148             
0149         <span class="keyword">end</span>
0150     <span class="keyword">end</span>
0151 <span class="keyword">end</span></pre></div>
<hr><address>EnergyPlus Co-simulation Toolbox &copy; 2018</address>
</body>
</html>