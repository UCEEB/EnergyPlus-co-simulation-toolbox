<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of startup_project</title>
  <meta name="keywords" content="startup_project">
  <meta name="description" content="clear command window">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../functionIndex.html">Home</a> &gt;  <a href="functionIndex.html">.</a> &gt; startup_project.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../functionIndex.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="functionIndex.html">Index for .&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>startup_project
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>clear command window</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> clear command window</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [] = matproj(varargin)</a></li><li><a href="#_sub2" class="code">function [numSaved] = save_matproj(outName,useGUI,varargin)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 
0002 <span class="comment">% clear command window</span>
0003 clc
0004 
0005 <span class="comment">%% Load state of the editor</span>
0006 disp(<span class="string">'============== Loading editor state ================================'</span>)
0007 proj = slproject.getCurrentProject;
0008 projRootFolder = proj.RootFolder;
0009 filename = <span class="string">'matproj.mat'</span>;
0010 <a href="#_sub1" class="code" title="subfunction [] = matproj(varargin)">matproj</a>(<span class="string">'LOAD'</span>, fullfile(projRootFolder, filename));
0011 disp(<span class="string">'============== Project opened ======================================'</span>)
0012 
0013 
0014 <span class="comment">%% Functions</span>
0015 <a name="_sub0" href="#_subfunctions" class="code">function [] = matproj(varargin)</a>
0016 <span class="comment">%</span>
0017 <span class="comment">% matproj.m--Saves and loads Matlab &quot;projects&quot;. A project consists of the</span>
0018 <span class="comment">% m-files that are currently open in the Matlab Editor. Loading a project</span>
0019 <span class="comment">% returns the Matlab Editor to the state it was in when the project was</span>
0020 <span class="comment">% saved, with the same m-files open to the same lines, the working</span>
0021 <span class="comment">% directory set to that of the loaded project and the Matlab search path</span>
0022 <span class="comment">% set back to its saved value.</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% When matproj.m is asked to load a project, it first saves the</span>
0025 <span class="comment">% currently-open m-files to a backup project before closing them and</span>
0026 <span class="comment">% loading the new project.</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% MATPROJ by itself, with no input arguments, uses GUI dialogues to ask the</span>
0029 <span class="comment">% user whether to save or load a project, after which the user is prompted</span>
0030 <span class="comment">% for a project filename (default is 'matproj.mat' in the current</span>
0031 <span class="comment">% directory).</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% MATPROJ('SAVE',FILENAME) saves the current project to the specified file</span>
0034 <span class="comment">% without using GUI dialogues.</span>
0035 <span class="comment">%</span>
0036 <span class="comment">% MATPROJ('LOAD',FILENAME) loads the project from the specified file</span>
0037 <span class="comment">% without using GUI dialogues.</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% MATPROJ('ADD',FILENAME) adds the project from the specified file</span>
0040 <span class="comment">% without closing files currently open and without using GUI dialogues.</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% MATPROJ('SAVE') saves the current project; a file-selection GUI dialogue</span>
0043 <span class="comment">% prompts the user to choose a destination file.</span>
0044 <span class="comment">%</span>
0045 <span class="comment">% MATPROJ('LOAD') loads a project;  a file-selection GUI dialogue prompts</span>
0046 <span class="comment">% the user to choose a file for loading.</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% e.g.,   matproj</span>
0049 <span class="comment">%         matproj('save','/home/bartlett/matproj.mat')</span>
0050 <span class="comment">%         matproj('load','/home/bartlett/matproj.mat')</span>
0051 <span class="comment">%         matproj('add','/home/bartlett/matproj.mat')</span>
0052 <span class="comment">%         matproj('save')</span>
0053 <span class="comment">%         matproj('load')</span>
0054 
0055 <span class="comment">% Developed in Matlab 7.12.0.635 (R2011a) on GLNX86</span>
0056 <span class="comment">% for the VENUS project (http://venus.uvic.ca/).</span>
0057 <span class="comment">% Kevin Bartlett (kpb@uvic.ca), 2012-06-13 18:08</span>
0058 <span class="comment">%-------------------------------------------------------------------------</span>
0059 
0060 <span class="comment">% See</span>
0061 <span class="comment">% http://blogs.mathworks.com/community/2011/05/09/r2011a-matlab-editor-api/</span>
0062 <span class="comment">% for information on how a lot of this stuff works.</span>
0063 
0064 <span class="comment">%-------------------------------------------------------------------------</span>
0065 <span class="comment">% REVISION HISTORY</span>
0066 <span class="comment">%-------------------------------------------------------------------------</span>
0067 <span class="comment">%</span>
0068 <span class="comment">% 2015-09-18--Added code to &quot;repair&quot; path in the event of a Matlab upgrade.</span>
0069 <span class="comment">%</span>
0070 <span class="comment">% 2016-02-25--Path repair not working on Windows. Bug fixed.</span>
0071 <span class="comment">%</span>
0072 <span class="comment">% 2016-04-28--Added action ADD. (user contribution from &quot;Andres&quot;).</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%-------------------------------------------------------------------------</span>
0075 
0076 <span class="comment">%-------------------------------------------------------------------------</span>
0077 <span class="comment">% Possible improvements:</span>
0078 <span class="comment">%</span>
0079 <span class="comment">% 1) Have a single, central file containing all projects, rather than a</span>
0080 <span class="comment">% separate matproj.mat file for each project?</span>
0081 <span class="comment">%-------------------------------------------------------------------------</span>
0082 
0083 <span class="keyword">if</span> nargin &gt; 0
0084     actionStr = varargin{1};
0085 <span class="keyword">else</span>
0086     actionStr = <span class="string">''</span>;
0087 <span class="keyword">end</span>
0088 
0089 <span class="keyword">if</span> nargin &gt; 1
0090     fileName = varargin{2};
0091 <span class="keyword">else</span>
0092     fileName = <span class="string">''</span>;
0093 <span class="keyword">end</span>
0094 
0095 <span class="keyword">if</span> ~matlab.desktop.editor.isEditorAvailable
0096     error([<span class="string">'Cannot run '</span> mfilename <span class="string">' without Java support.'</span>]);
0097 <span class="keyword">end</span>
0098 
0099 <span class="comment">% Stick with command-line interface unless user wants GUI.</span>
0100 useGUI = false;
0101 
0102 <span class="keyword">if</span> isempty(actionStr)
0103     <span class="comment">% No action specified. Get via GUI.</span>
0104     useGUI = true;
0105     actionList = {<span class="string">'Save'</span>, <span class="string">'Load'</span>, <span class="string">'Add'</span>};
0106     [Selection,isOk] = listdlg(<span class="string">'ListString'</span>,actionList,<span class="keyword">...</span>
0107         <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>,<span class="keyword">...</span>
0108         <span class="string">'ListSize'</span>,[160 60],<span class="keyword">...</span>
0109         <span class="string">'Name'</span>,<span class="string">'matproj'</span>,<span class="keyword">...</span>
0110         <span class="string">'PromptString'</span>,<span class="string">'Select Project Action'</span>);
0111     
0112     <span class="keyword">if</span> isOk
0113         actionName = actionList{Selection};
0114     <span class="keyword">else</span>
0115         actionName = <span class="string">'Cancel'</span>;
0116     <span class="keyword">end</span>
0117     
0118     actionStr = lower(actionName);
0119 <span class="keyword">end</span>
0120 
0121 SAVE = 1;
0122 LOAD = 2;
0123 ADD = 3;
0124 
0125 <span class="keyword">if</span> strcmpi(actionStr,<span class="string">'save'</span>)
0126     action = SAVE;
0127 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'load'</span>)
0128     action = LOAD;
0129 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'add'</span>)
0130     action = ADD;
0131 <span class="keyword">elseif</span> strcmpi(actionStr,<span class="string">'cancel'</span>)
0132     <span class="keyword">return</span>;
0133 <span class="keyword">else</span>
0134     error([mfilename <span class="string">'.m--Unrecognised action string '''</span> actionStr <span class="string">'''.'</span>]);
0135 <span class="keyword">end</span>
0136 
0137 <span class="keyword">if</span> isempty(fileName)
0138     <span class="comment">% No filename specified. Choose it with a GUI.</span>
0139     useGUI = true;
0140     <span class="keyword">if</span> action == LOAD
0141         [fileName, pathName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to load.'</span>,pwd);
0142     <span class="keyword">elseif</span> action == ADD
0143         [fileName, pathName] = uigetfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to add.'</span>,pwd);
0144     <span class="keyword">elseif</span> action == SAVE
0145         [fileName, pathName] = uiputfile(<span class="string">'*.mat'</span>, <span class="string">'Pick a Matlab project file to save.'</span>,fullfile(pwd,<span class="string">'matproj.mat'</span>));
0146     <span class="keyword">end</span>
0147     
0148     <span class="keyword">if</span> isa(fileName,<span class="string">'double'</span>)
0149         <span class="keyword">return</span>;
0150     <span class="keyword">end</span>
0151     fullName = fullfile(pathName,fileName);
0152 <span class="keyword">else</span>
0153     fullName = fullfile(fileName);
0154 <span class="keyword">end</span>
0155 
0156 <span class="keyword">if</span> action == LOAD || action == ADD
0157     <span class="comment">% Save a backup of the current desktop.</span>
0158     docHndl = matlab.desktop.editor.getAll();
0159     numFiles = length(docHndl);
0160     
0161     <span class="keyword">if</span> numFiles &gt; 0
0162         <span class="comment">% Only save a backup if there are files open.</span>
0163         disp([mfilename <span class="string">'.m--Saving backup of existing project...'</span>])
0164         backupFileName = fullfile(prefdir,<span class="string">'matproj.bak.mat'</span>);
0165         numSaved = <a href="#_sub2" class="code" title="subfunction [numSaved] = save_matproj(outName,useGUI,varargin)">save_matproj</a>(backupFileName,useGUI,docHndl);
0166         
0167         <span class="keyword">if</span> numSaved &lt; 0
0168             <span class="comment">% save_matproj.m returns -1 if aborting.</span>
0169             <span class="keyword">return</span>;
0170         <span class="keyword">end</span>
0171         
0172         <span class="keyword">if</span> numSaved == 0
0173             disp([mfilename <span class="string">'.m--Backup of existing project NOT saved.'</span>])
0174         <span class="keyword">else</span>
0175             disp([mfilename <span class="string">'.m--Backup of existing project saved to '</span> backupFileName <span class="string">'.'</span>])
0176         <span class="keyword">end</span>
0177     <span class="keyword">end</span>
0178     
0179     <span class="comment">% Read in previously-saved project info.</span>
0180     [~,~,ext] = fileparts(fullName);
0181     <span class="keyword">if</span> strcmp(ext,<span class="string">'.mat'</span>)
0182         whoOut = who(<span class="string">'-file'</span>,fullName);
0183         <span class="keyword">if</span> ~ismember(<span class="string">'matprojData'</span>,whoOut)
0184             error([mfilename <span class="string">'.m--Specified .mat file does not appear to contain matproj data.'</span>]);
0185         <span class="keyword">end</span>
0186         load(fullName,<span class="string">'matprojData'</span>);
0187     <span class="keyword">else</span>
0188         error([mfilename <span class="string">'.m--Specified file is not a .mat file.'</span>]);
0189     <span class="keyword">end</span>
0190     
0191     <span class="keyword">if</span> action == LOAD
0192         <span class="comment">% Close existing project. This won't happen if action is ADD.</span>
0193         docHndl = matlab.desktop.editor.getAll();
0194         numFiles = length(docHndl);
0195         <span class="keyword">for</span> iFile = 1:numFiles
0196             docHndl(iFile).close;
0197         <span class="keyword">end</span>
0198     <span class="keyword">end</span>
0199     
0200     <span class="comment">% Open previously-saved project.</span>
0201     numFiles = length(matprojData.files);
0202     
0203     <span class="keyword">for</span> iFile = 1:numFiles
0204         thisMatProjMember = matprojData.files(iFile);
0205         thisFileName = thisMatProjMember.Filename;
0206         thisSelection = thisMatProjMember.Selection;
0207         thisEditable = thisMatProjMember.Editable;
0208         
0209         <span class="comment">% 2015-01-28--Thanks to David Brown for pointing this out. Loading</span>
0210         <span class="comment">% a project fails if it was saved with an unsaved &quot;untitled&quot; mfile</span>
0211         <span class="comment">% in it. Test to avoid the error.</span>
0212         [thisFilePath,~,ext] = fileparts(thisFileName);
0213         <span class="keyword">if</span> isempty(thisFilePath)
0214             warning([mfilename <span class="string">'.m--Skipping loading file '''</span> thisFileName ext <span class="string">''' because no path information for it was found.'</span>]);
0215         <span class="keyword">else</span>
0216             editorObj = matlab.desktop.editor.openDocument(thisFileName);
0217             
0218             <span class="keyword">if</span> isempty(editorObj)
0219                 warning([mfilename <span class="string">'.m--File '</span> thisFileName <span class="string">' from loaded project was not found.'</span>]);
0220             <span class="keyword">else</span>
0221                 
0222                 <span class="keyword">if</span> isempty(thisSelection)
0223                     thisSelection = [1 1 1 1];
0224                 <span class="keyword">end</span> <span class="comment">% end if isempty(thisSelection)</span>
0225                 
0226                 editorObj.Selection = thisSelection;
0227                 editorObj.Editable = thisEditable;
0228             <span class="keyword">end</span> <span class="comment">% if isempty(editorObj)</span>
0229             
0230         <span class="keyword">end</span> <span class="comment">% if isempty thisFilePath</span>
0231         
0232     <span class="keyword">end</span> <span class="comment">% for</span>
0233     
0234     <span class="comment">% Open the active document again to make it the current file.</span>
0235     activeDocName = matprojData.activeDocName;
0236     
0237     <span class="keyword">if</span> ~isempty(activeDocName)
0238         <span class="comment">% ...Again, make sure this isn't an unsaved &quot;untitled&quot; document.</span>
0239         [thisFilePath,~,ext] = fileparts(activeDocName);
0240         <span class="keyword">if</span> ~isempty(thisFilePath)
0241             <span class="keyword">if</span> ~isempty(activeDocName)
0242                 editorObj = matlab.desktop.editor.openDocument(matprojData.activeDocName);
0243             <span class="keyword">end</span>
0244         <span class="keyword">end</span>
0245     <span class="keyword">end</span>
0246     
0247     cd(matprojData.workingDir);
0248     
0249 <span class="keyword">elseif</span> action == SAVE
0250     <span class="keyword">if</span> exist(fullName,<span class="string">'file'</span>)
0251         <span class="comment">% uiputfile already handles overwrite dialogue, so only need case</span>
0252         <span class="comment">% for command-line interface.</span>
0253         <span class="keyword">if</span> ~useGUI
0254             r = input([<span class="string">'File '</span> fullName <span class="string">' already exists. Overwrite? [Yes/No] '</span>],<span class="string">'s'</span>);
0255             <span class="keyword">if</span> ~strncmpi(r,<span class="string">'y'</span>,1)
0256                 <span class="keyword">return</span>;
0257             <span class="keyword">end</span>
0258         <span class="keyword">end</span>
0259     <span class="keyword">end</span>
0260     numSaved = <a href="#_sub2" class="code" title="subfunction [numSaved] = save_matproj(outName,useGUI,varargin)">save_matproj</a>(fullName,useGUI);
0261 <span class="keyword">end</span>
0262 <span class="keyword">end</span>
0263 
0264 <span class="comment">%-------------------------------------------------------------------------</span>
0265 <a name="_sub1" href="#_subfunctions" class="code">function [numSaved] = save_matproj(outName,useGUI,varargin)</a>
0266 <span class="comment">%</span>
0267 <span class="comment">% save_matproj.m--Saves current project to named .mat file.</span>
0268 <span class="comment">%-------------------------------------------------------------------------</span>
0269 
0270 <span class="keyword">if</span> nargin&gt;2
0271     docHndl = varargin{1};
0272 <span class="keyword">else</span>
0273     docHndl = matlab.desktop.editor.getAll();
0274 <span class="keyword">end</span>
0275 
0276 numFiles = length(docHndl);
0277 
0278 <span class="keyword">if</span> numFiles == 0
0279     numSaved = 0;
0280 <span class="keyword">end</span>
0281 
0282 <span class="keyword">if</span> any(cat(1,docHndl.Modified))
0283     <span class="keyword">if</span> useGUI
0284         warndlg(<span class="string">'Unsaved edits exist in existing project. Aborting.'</span>, <span class="string">'matproj'</span>, <span class="string">'modal'</span>);
0285     <span class="keyword">else</span>
0286         disp([mfilename <span class="string">'.m--Unsaved edits exist in existing project. Aborting.'</span>]);
0287     <span class="keyword">end</span>
0288     numSaved = -1;
0289     <span class="keyword">return</span>;
0290 <span class="keyword">end</span>
0291 
0292 activeDoc = matlab.desktop.editor.getActive;
0293 files = repmat(struct(<span class="string">'Filename'</span>,<span class="string">''</span>,<span class="string">'Selection'</span>,nan(1,4),<span class="string">'Editable'</span>,NaN),numFiles,1);
0294 
0295 <span class="keyword">for</span> iFile = 1:numFiles
0296     files(iFile).Filename = docHndl(iFile).Filename;
0297     files(iFile).Selection = docHndl(iFile).Selection;
0298     files(iFile).Editable = docHndl(iFile).Editable;
0299 <span class="keyword">end</span>
0300 
0301 matprojData = struct();
0302 matprojData.files = files;
0303 matprojData.date = now;
0304 
0305 <span class="keyword">if</span> isempty(activeDoc)
0306     activeDocName = [];
0307 <span class="keyword">else</span>
0308     activeDocName = activeDoc.Filename;
0309 <span class="keyword">end</span>
0310 
0311 matprojData.activeDocName = activeDocName;
0312 matprojData.workingDir = pwd;
0313 projPath = path;
0314 matprojData.path = projPath;
0315 
0316 save(outName,<span class="string">'matprojData'</span>);
0317 numSaved = numFiles;
0318 
0319 <span class="keyword">end</span></pre></div>
<hr><address>EnergyPlus Co-simulation Toolbox &copy; 2018</address>
</body>
</html>